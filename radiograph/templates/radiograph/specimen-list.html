{% extends "radiograph/base.html" %}
{% load url from future %}
{% load static from staticfiles %}
{% load paginate from radiograph %}

{% block content %}

<div id="results-target"></div>

<div class="row panel panel-default">
    <form class="search-form" method="GET">
        <input type="hidden" name="page" value="{{ search_form.page.value|default:"" }}"/>
        <input type="hidden" name="view" value="{{ search_form.view.value|default:"" }}"/>
        {% comment %}
        <input type="hidden" name="sex" value="{{ search_form.sex.value|default:"" }}"/>
        <input type="hidden" name="results" value="{{ search_form.results.value|default:"" }}"/>
        <input type="hidden" name="taxa" value="{{ search_form.taxa.value|default:"" }}"/>
        {% endcomment %}

        <div class="span12">

            <div class="search-results-header row panel-heading">
                <div class="search-results-header">
                     <span class="dropdown">
                         <a href="#" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                             <input type="checkbox" class="item-selector"/>
                             <span class="caret"></span>
                         </a>
                         <ul class="dropdown-menu">
                             <li>
                                 <a href="#" data-selection="all">
                                     <i class="fa fa-check-square-o"></i>
                                     Select All
                                 </a>
                             </li>
                             <li>
                                 <a href="#" data-selection="none">
                                     <i class="fa fa-square-o"></i>
                                     Select None
                                 </a>
                             </li>
                             <li>
                                 <a href="#" data-selection="invert">
                                     <i class="fa fa-check-square"></i>
                                     Invert Selection
                                 </a>
                             </li>
                         </ul>
                     </span>

                    <button class="btn btn-primary" data-toggle="modal" data-target="#download-dialog">
                        <i class="fa fa-cloud-download"></i> Download
                    </button>

                    <button class="btn btn-primary">
                        <i class="fa fa-filter"></i> Filter: Taxon
                    </button>

                    <button class="btn btn-primary">
                        <i class="fa fa-filter"></i> Filter: Sex
                    </button>

                    Show 
                    <div class="btn-group"> <button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown">
                            20 <span class="caret"></span>
                        </button>

                        <ul class="dropdown-menu" role="menu">
                            <li><a href="#">20</a></li>
                            <li><a href="#">50</a></li>
                            <li><a href="#">100</a></li>
                        </ul>
                    </div>
                    results per page.

                    {# View Selector #}
                    <div class="btn-group select-view" data-toggle="buttons">
                        <label class="btn btn-primary" title="Standard"
                            {% if search_form.view.value == 'standard' %}active{% endif %}">
                            <input type="radio" name="view" value="standard"/>
                            <i class="fa fa-th-list"></i>
                        </label>
                        <label class="btn btn-primary" title="Compact"
                            {% if search_form.view.value == 'compact' %}active{% endif %}">
                            <input type="radio" name="view" value="compact"/>
                            <i class="fa fa-align-justify"></i>
                        </label>
                        <label class="btn btn-primary" title="Tiles"
                            {% if search_form.view.value == 'tiles' %}active{% endif %}">
                            <input type="radio" name="view" value="tiles"/>
                            <i class="fa fa-th-large"></i>
                        </label>
                    </div>
                </div>

                <div class="pagination-toolbar col-md-6">

                    <ul class="pagination">
                        {% for pnav in search_form.results_page|paginate %}
                        <li {% if pnav.is_current %}class="active"{% endif %}>
                            <a href="?page={{ pnav.page_number }}" data-value="{{ pnav.page_number }}">{{ pnav.display }}</a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                {# Results per page selector #}
                {% comment %}
                Showing 
                <div class="results">
                    <a class="dropdown-toggle" data-toggle="dropdown">
                        <span class="results-per-page">20</span>
                        <span class="caret"></span>
                    </a>
                    
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" data-value="10">10</a></li>
                        <li><a href="#" data-value="20">20</a></li>
                        <li><a href="#" data-value="50">50</a></li>
                        <li><a href="#" data-value="100">100</a></li>
                    </ul>
                </div> results per page

                {# Taxon Sort/Filter #}
                <span class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        Taxon
                        <span class="caret"></span>
                    </a>
                    <div class="dropdown-menu">
                        <ul>
                            <li>Tree</li>
                            <li>Goes</li>
                            <li>Here</li>
                        </ul>
                    </div>
                </span>

                {# Sex Sort/Filter #}
                <span class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        Sex
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="#">
                                <input id="filter-sex-male" type="checkbox"/>
                                <label for="filter-sex-male">Male</label>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <input id="filter-sex-female" type="checkbox"/>
                                <label for="filter-sex-female">Female</label>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <input id="filter-sex-unknown" type="checkbox"/>
                                <label for="filter-sex-unknown">Unknown/Unspecified</label>
                            </a>
                        </li>
                    </ul>
                </span>
                {% endcomment %}

            </div>
            
            <div class="search-results panel-body">
                {% with search_form.view.value|default:search_form.view.field.initial as result_view %}
                    {% for specimen in search_form.results_page.object_list %}
                        {% with "radiograph/specimen-result-"|add:result_view|add:".html" as result_template %}
                        {% include result_template %}
                        {% endwith %}
                    {% endfor %}
                {% endwith %}
            </div>
            
            <div class="search-results-footer row">
                <div class="pagination-toolbar col-md-6">

                    <ul class="pagination">
                        {% for pnav in search_form.results_page|paginate %}
                        <li {% if pnav.is_current %}class="active"{% endif %}>
                            <a href="?page={{ pnav.page_number }}" data-value="{{ pnav.page_number }}">{{ pnav.display }}</a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </form>
</div>

{# Download dialog #}
<div id="download-dialog" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4>Which data would you like to download?</h4>
            </div>
            <div class="modal-body">
                <label class="download-range-option">
                    <input type="radio" name="download-range-type" value="this-page"/>
                    Only selections on this page (20 images, approximately 34 MB)
                </label>

                <label class="download-range-option">
                    <input type="radio" name="download-range-type" value="all"/>
                    Selections for this query on all pages (123 images, approximately 178 MB)
                </label>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Nevermind</button>
                <button type="button" class="btn btn-primary">Download</button>
            </div>
        </div>
    </div>
</div>

{# Image detail dialog #}
<div id="image-detail-dialog" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                Image Detail
            </div>
            <div class="modal-body">
                <figure style="background-image:url('http://placekitten.com/1024/1024')"></figure>
            </div>
        </div>
    </div>
</div>

<div id="tree"></div>

{% endblock %}

{% block header_resources %}
    {{ block.super }}
    {# <link type="text/css" rel="stylesheet" href="{% static 'yui/build/treeview/assets/skins/sam/treeview.css' %}"/> #}
{% endblock %}

{% block scripts %}
    {{ block.super }}

    <script type="text/javascript">
        $(function() {
            var form = $('form.search-form'),
                pageInput = form.find('[name=page]'),
                viewInput = form.find('[name=view]');
            
            $('.pagination a').on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                pageInput.val($(e.currentTarget).data('value'));
                form.submit();
            });

            $('.select-view a').on('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                viewInput.val($(e.currentTarget).data('value'));
                $(e.currentTarget).siblings('a').removeClass('active');
                $(e.currentTarget).addClass('active');
                form.submit();
            });
    
            //=====================================
            // Search result selection tools
            //=====================================
            var selectAll = function() {
                $('.item-selection[type=checkbox]').prop('checked', true)
            }

            var selectNone = function() {
                $('.item-selection[type=checkbox]').prop('checked', false)
            }

            var invertSelection = function() {
                $('.item-selection[type=checkbox]').each(function(idx, elt) {
                    var $elt = $(elt)
                    $elt.prop('checked', !$elt.prop('checked'))
                })
            }

            $('[data-selection]').on('click', function(e) {
                var selectionOp = $(e.currentTarget).data('selection')
                if(selectionOp == 'all') {
                    selectAll()
                } else if(selectionOp == 'none') {
                    selectNone()
                } else if (selectionOp == 'invert') {
                    invertSelection()
                }
            });

            $('.item-selector[type=checkbox]').on('click', function(e) {
                e.stopPropagation()
                if($(e.currentTarget).is(':checked')) {
                    selectAll()
                } else {
                    selectNone()
                }
            });

            $('[data-image-detail]').on('click', function(e) {
                var imageDetailModal = $('#image-detail-dialog')
                imageDetailModal.find('.modal-body figure')
                imageDetailModal.modal();
            });
        });
    </script>

    <!--script type="text/javascript" 
    src="{% static 'yui/build/yahoo-dom-event/yahoo-dom-event.js' %}">
    </script>

    <script type="text/javascript"
        src="{% static 'yui/build/treeview/treeview-min.js' %}"></script>

    <script type="text/javascript">
        var tv = new YAHOO.widget.TreeView("tree");
        var root = tv.getRoot();
        var child1 = new YAHOO.widget.TextNode("Node 1", root, false);
        var child2 = new YAHOO.widget.TextNode("Node 2", root, false);
        tv.draw();
    </script-->
{% endblock %}

